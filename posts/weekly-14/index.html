<!doctype html><html lang=en><head><meta charset=utf-8><meta name=generator content="Hugo 0.101.0"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Airing"><meta property="og:url" content="https://weekly.ursb.me/posts/weekly-14/"><link rel=canonical href=https://weekly.ursb.me/posts/weekly-14/><link rel=apple-touch-icon href=https://airing.ursb.me/image/favicon.ico><link rel=icon href=https://airing.ursb.me/image/favicon.ico><link rel=shortcut href=https://airing.ursb.me/image/favicon.ico><link rel=alternate type=application/atom+xml href=https://weekly.ursb.me/index.xml title="Airing Weekly"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/weekly.ursb.me\/"},"articleSection":"posts","name":"WJ.14: Chromium Rendering Pipeline - Introduce","headline":"WJ.14: Chromium Rendering Pipeline - Introduce","description":"Warning\n如果您看到本提示，说明该文章目前仍未完成，会不定期迭代更新，该系列文章完成时会合稿发布博客。如果您有任何疑问或反馈，请联系 @airing。Last update: August 20 2022\nPurpose of this document\n本文档系个人研究 Chromium 渲染管线的笔记记录，本文介绍 Chromium 的一些基础知识与渲染管线的主要流程。\n本文分析的源码基于当前最新版本 107，每个版本类名\/函数名和对应的具体实现或许有所差异，但主逻辑目前来看不会有所变动。\n推荐阅读本系列后续文章：\nChromium Rendering Pipeline - Parsing Introduce to Blink Blink 是 Web 的渲染引擎，Chromium 和 Android Webview 都是用 Blink 作为渲染引擎。\nBlink Public API Figure: Blink in Web platform 你可以阅读 How Blink works 获取更多关于 Blink 的知识。 Blink 包括以下特性：\n实现了 Web 平台的规范（也就是 HTML 标准），包括 DOM，CSS 和 WebIDL； 内嵌 V8 运行 JavaScript； 通过底层的网络栈请求资源； 构建 DOM 树； 计算样式和排版； 内嵌 Chrome Compositor 用于绘图； Source to read","inLanguage":"en-US","author":"Airing","creator":"Airing","publisher":"Airing","accountablePerson":"Airing","copyrightHolder":"Airing","copyrightYear":"2022","datePublished":"2022-08-14 13:37:47 \u002b0800 \u002b0800","dateModified":"2022-08-14 13:37:47 \u002b0800 \u002b0800","url":"https:\/\/weekly.ursb.me\/posts\/weekly-14\/","keywords":[]}</script><title>WJ.14: Chromium Rendering Pipeline - Introduce</title><meta property="og:title" content="WJ.14: Chromium Rendering Pipeline - Introduce"><meta property="og:type" content="article"><meta property="og:description" content="Warning
如果您看到本提示，说明该文章目前仍未完成，会不定期迭代更新，该系列文章完成时会合稿发布博客。如果您有任何疑问或反馈，请联系 @airing。Last update: August 20 2022
Purpose of this document
本文档系个人研究 Chromium 渲染管线的笔记记录，本文介绍 Chromium 的一些基础知识与渲染管线的主要流程。
本文分析的源码基于当前最新版本 107，每个版本类名/函数名和对应的具体实现或许有所差异，但主逻辑目前来看不会有所变动。
推荐阅读本系列后续文章：
Chromium Rendering Pipeline - Parsing Introduce to Blink Blink 是 Web 的渲染引擎，Chromium 和 Android Webview 都是用 Blink 作为渲染引擎。
Blink Public API Figure: Blink in Web platform 你可以阅读 How Blink works 获取更多关于 Blink 的知识。 Blink 包括以下特性：
实现了 Web 平台的规范（也就是 HTML 标准），包括 DOM，CSS 和 WebIDL； 内嵌 V8 运行 JavaScript； 通过底层的网络栈请求资源； 构建 DOM 树； 计算样式和排版； 内嵌 Chrome Compositor 用于绘图； Source to read"><meta name=description content="Warning
如果您看到本提示，说明该文章目前仍未完成，会不定期迭代更新，该系列文章完成时会合稿发布博客。如果您有任何疑问或反馈，请联系 @airing。Last update: August 20 2022
Purpose of this document
本文档系个人研究 Chromium 渲染管线的笔记记录，本文介绍 Chromium 的一些基础知识与渲染管线的主要流程。
本文分析的源码基于当前最新版本 107，每个版本类名/函数名和对应的具体实现或许有所差异，但主逻辑目前来看不会有所变动。
推荐阅读本系列后续文章：
Chromium Rendering Pipeline - Parsing Introduce to Blink Blink 是 Web 的渲染引擎，Chromium 和 Android Webview 都是用 Blink 作为渲染引擎。
Blink Public API Figure: Blink in Web platform 你可以阅读 How Blink works 获取更多关于 Blink 的知识。 Blink 包括以下特性：
实现了 Web 平台的规范（也就是 HTML 标准），包括 DOM，CSS 和 WebIDL； 内嵌 V8 运行 JavaScript； 通过底层的网络栈请求资源； 构建 DOM 树； 计算样式和排版； 内嵌 Chrome Compositor 用于绘图； Source to read"><meta property="og:locale" content="en-us"><meta property="og:image" content="https://airing.ursb.me/image/favicon.ico"><style>body{font-family:bree serif,lxgw wenkai gb,sans-serif;-webkit-font-smoothing:antialiased;margin:0 20px;word-break:break-all}article{max-width:800px;margin-left:auto;margin-right:auto}a{color:#000;text-decoration:none}a:hover{font-weight:600;text-decoration:underline}.post-ads{margin:50px 0}.markdown-body{font-size:18px;max-width:100%}.markdown-body a{text-decoration:underline;text-decoration-color:#000}.markdown-body blockquote{margin:0;padding:0 1em;color:#57606a;border-left:.25em solid #d0d7de}.markdown-body pre{padding:16px;overflow:auto}.markdown-body code{padding:.2em .4em;font-size:85%;background-color:#f6f8fa;border-radius:6px}.markdown-body pre>code{padding:0;background-color:inherit;border:0;font:14.4px/24px ibm plex mono,Menlo,Consolas,monospace}.Chinese .markdown-body{line-height:200%}.site-date-catalog{font-size:2rem}.header-title{font-size:2rem;font-weight:700;margin-top:32px;font-family:bungee shade,sans-serif}.header-title a{text-decoration:none}.header-subtitle{color:#666}.header-items{margin:10px 0}.header-item{margin:0 5px}.header-line{width:100%;border-width:2px;border-color:#482936;border-style:solid none none none}.lang-switch{font-weight:600}#posts-list{min-height:600px}.posts-line{font-size:1.2rem;margin:12px 0}.posts-categories{font-size:.8rem;margin:auto;text-align:center}.posts-category{margin-bottom:3px}.site-footer{margin-top:50px}.site-footer-item{margin-right:12px}.post-content img{max-width:100%;display:block;margin-right:auto;margin-top:12px}.post-header{margin-bottom:50px}.post-title{font-size:2rem;font-weight:600}.post-tags{display:inline;font-weight:600;padding:2px 5px;margin-right:6px;border:#000 2px solid;border-radius:5px}.post-date{font-weight:800;font-style:italic}.post-author{float:right;font-weight:600}.page-content{min-height:60%}.post-content{margin-bottom:50px}.post-content p{hyphens:auto;line-height:1.8;text-justify:ideographic;margin-bottom:1em}.related-content{border-width:3px;border-style:solid;border-color:#000;padding:0 10px;margin-bottom:50px;margin-top:100px}.related-content li{margin:5px 0}.taxonomy-term{font-size:3rem}.gallery-img{text-align:center}.gallery-img span{text-align:center}.gallery-img-desc{font-size:.8em;font-weight:800}#disqus_thread{position:relative}#disqus_thread:after{content:"";display:block;height:55px;width:100%;position:absolute;bottom:0;background:#fff}@media screen and (max-width:600px){.header-title,.header-subtitle,.header-items{text-align:center}.posts-line{font-size:16px}.markdown-body{font-size:16px}.post-title{font-size:2rem}.post-content p{letter-spacing:.05em}}@media screen and (max-width:48em){.posts-category{display:none}}.admonition{margin:0 -20px;padding:5px 20px}.admonition .admonition-title{font-weight:700;margin-bottom:0;margin-right:5px;float:left}.admonition.warning{background:#fbe9e7;color:#a30000;margin:0 -20px;padding:5px 20px}.admonition.sourcecode{background:rgba(38,139,210,.1)}.admonition.tryit{background:#b9f6ca}.admonition.tryit .codehilite{background-color:transparent;color:inherit;margin:0}.admonition.tryit .codehilite .c{color:grey}.content{padding-top:20px;width:800px;margin-left:auto;margin-right:auto}.box{width:800px;margin-left:auto;margin-right:auto;margin-top:50px;margin-bottom:50px;padding:20px}.box-centered{text-align:center}.box-white{background:#fff;border:1px solid #ccc;box-shadow:2px 2px 8px #aaa;border-radius:5px}.aside{position:absolute;right:0;top:0;width:240px;text-align:left;font-size:.8em;margin-right:-280px}@media only screen and (max-width:1280px){.box{width:auto;left:0;right:0;margin:0}.box-white{border:none}.content{width:auto;left:0;right:0;margin:0}.aside{margin-right:0;position:relative;right:0;width:auto;font-size:.8em;line-height:1.5em;background-color:rgba(128,128,128,.1);display:block;padding:5px}body{padding:5px}div.codehilite{font:10px/13px ibm plex mono,Menlo,Consolas,monospace;margin:0 -5px;padding:5px}}code{font:14.4px/24px ibm plex mono,Menlo,Consolas,monospace;white-space:pre}.aside code{font:12.96px/21.6px ibm plex mono,Menlo,Consolas,monospace!important}pre{font:16px/24px ibm plex mono,Menlo,Consolas,monospace}div.epigraph blockquote{margin-right:0;float:right;font-style:italic}div.epigraph blockquote .footer{font-style:normal;text-align:right}figure{margin-left:auto;margin-right:auto}figure img{margin-left:auto}figcaption{font-size:.87em;color:#3c40439c;text-align:center}figcaption a{color:#3c40439c}</style><style>.highlight{line-height:initial}.highlight pre{--bg:#fff;--fg:#000;--comment:#6a737d;--punctuation:inherit;--operator:inherit;--entity:#6f42c1;--keyword:#d73a49;--variable:#e36209;--string-constant:#032f62;--numeric-constant:#005cc5;padding:1em;background:var(--bg);color:var(--fg)}.highlight pre .p{color:var(--punctuation)}.highlight pre .na,.highlight pre .nb,.highlight pre .nc,.highlight pre .no,.highlight pre .nd,.highlight pre .ni,.highlight pre .ne,.highlight pre .nf,.highlight pre .nl,.highlight pre .nn,.highlight pre .nx,.highlight pre .py,.highlight pre .nt{color:var(--entity)}.highlight pre .vc,.highlight pre .vg,.highlight pre .vi,.highlight pre .nv{color:var(--variable)}.highlight pre .bp{}.highlight pre .o,.highlight pre .ow{color:var(--operator)}.highlight pre .c,.highlight pre .cm,.highlight pre .cp,.highlight pre .c1,.highlight pre .cs{color:var(--comment);font-style:italic}.highlight pre .k,.highlight pre .kc,.highlight pre .kd,.highlight pre .kn,.highlight pre .kp,.highlight pre .kr,.highlight pre .kt{color:var(--keyword);font-weight:500}.highlight pre .s,.highlight pre .sb,.highlight pre .sd,.highlight pre .sc,.highlight pre .s2,.highlight pre .se,.highlight pre .sh,.highlight pre .si,.highlight pre .sx,.highlight pre .sr,.highlight pre .ss,.highlight pre .s1{color:var(--string-constant)}.highlight pre .m,.highlight pre .mi,.highlight pre .mf{color:var(--numeric-constant)}.highlight pre .gi{color:#22863a;background-color:#f0fff4}.highlight pre .gd{color:#b31d28;background-color:#ffeef0}</style><style>.container,.container-fluid{margin-right:auto;margin-left:auto}.container-fluid{padding-right:2rem;padding-left:2rem}.row{box-sizing:border-box;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-flex:0;-ms-flex:0 1 auto;flex:initial;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-right:-.5rem;margin-left:-.5rem}.row.reverse{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.col.reverse{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.col-xs,.col-xs-1,.col-xs-10,.col-xs-11,.col-xs-12,.col-xs-2,.col-xs-3,.col-xs-4,.col-xs-5,.col-xs-6,.col-xs-7,.col-xs-8,.col-xs-9,.col-xs-offset-0,.col-xs-offset-1,.col-xs-offset-10,.col-xs-offset-11,.col-xs-offset-12,.col-xs-offset-2,.col-xs-offset-3,.col-xs-offset-4,.col-xs-offset-5,.col-xs-offset-6,.col-xs-offset-7,.col-xs-offset-8,.col-xs-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-xs{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-xs-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-xs-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-xs-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-xs-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-xs-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-xs-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-xs-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-xs-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-xs-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-xs-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-xs-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-xs-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-xs-offset-0{margin-left:0}.col-xs-offset-1{margin-left:8.33333333%}.col-xs-offset-2{margin-left:16.66666667%}.col-xs-offset-3{margin-left:25%}.col-xs-offset-4{margin-left:33.33333333%}.col-xs-offset-5{margin-left:41.66666667%}.col-xs-offset-6{margin-left:50%}.col-xs-offset-7{margin-left:58.33333333%}.col-xs-offset-8{margin-left:66.66666667%}.col-xs-offset-9{margin-left:75%}.col-xs-offset-10{margin-left:83.33333333%}.col-xs-offset-11{margin-left:91.66666667%}.start-xs{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-xs{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-xs{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-xs{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-xs{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-xs{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-xs{-ms-flex-pack:distribute;justify-content:space-around}.between-xs{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-xs{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-xs{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}@media only screen and (min-width:48em){.container{width:49rem}.col-sm,.col-sm-1,.col-sm-10,.col-sm-11,.col-sm-12,.col-sm-2,.col-sm-3,.col-sm-4,.col-sm-5,.col-sm-6,.col-sm-7,.col-sm-8,.col-sm-9,.col-sm-offset-0,.col-sm-offset-1,.col-sm-offset-10,.col-sm-offset-11,.col-sm-offset-12,.col-sm-offset-2,.col-sm-offset-3,.col-sm-offset-4,.col-sm-offset-5,.col-sm-offset-6,.col-sm-offset-7,.col-sm-offset-8,.col-sm-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-sm{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-sm-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-sm-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-sm-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-sm-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-sm-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-sm-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-sm-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-sm-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-sm-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-sm-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-sm-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-sm-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-sm-offset-0{margin-left:0}.col-sm-offset-1{margin-left:8.33333333%}.col-sm-offset-2{margin-left:16.66666667%}.col-sm-offset-3{margin-left:25%}.col-sm-offset-4{margin-left:33.33333333%}.col-sm-offset-5{margin-left:41.66666667%}.col-sm-offset-6{margin-left:50%}.col-sm-offset-7{margin-left:58.33333333%}.col-sm-offset-8{margin-left:66.66666667%}.col-sm-offset-9{margin-left:75%}.col-sm-offset-10{margin-left:83.33333333%}.col-sm-offset-11{margin-left:91.66666667%}.start-sm{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-sm{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-sm{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-sm{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-sm{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-sm{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-sm{-ms-flex-pack:distribute;justify-content:space-around}.between-sm{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-sm{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-sm{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}@media only screen and (min-width:64em){.container{width:65rem}.col-md,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9,.col-md-offset-0,.col-md-offset-1,.col-md-offset-10,.col-md-offset-11,.col-md-offset-12,.col-md-offset-2,.col-md-offset-3,.col-md-offset-4,.col-md-offset-5,.col-md-offset-6,.col-md-offset-7,.col-md-offset-8,.col-md-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-md{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-md-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-md-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-md-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-md-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-md-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-md-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-md-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-md-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-md-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-md-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-md-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-md-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-md-offset-0{margin-left:0}.col-md-offset-1{margin-left:8.33333333%}.col-md-offset-2{margin-left:16.66666667%}.col-md-offset-3{margin-left:25%}.col-md-offset-4{margin-left:33.33333333%}.col-md-offset-5{margin-left:41.66666667%}.col-md-offset-6{margin-left:50%}.col-md-offset-7{margin-left:58.33333333%}.col-md-offset-8{margin-left:66.66666667%}.col-md-offset-9{margin-left:75%}.col-md-offset-10{margin-left:83.33333333%}.col-md-offset-11{margin-left:91.66666667%}.start-md{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-md{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-md{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-md{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-md{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-md{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-md{-ms-flex-pack:distribute;justify-content:space-around}.between-md{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-md{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-md{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}@media only screen and (min-width:75em){.container{width:76rem}.col-lg,.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-lg-offset-0,.col-lg-offset-1,.col-lg-offset-10,.col-lg-offset-11,.col-lg-offset-12,.col-lg-offset-2,.col-lg-offset-3,.col-lg-offset-4,.col-lg-offset-5,.col-lg-offset-6,.col-lg-offset-7,.col-lg-offset-8,.col-lg-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-lg{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-lg-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-lg-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-lg-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-lg-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-lg-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-lg-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-lg-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-lg-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-lg-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-lg-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-lg-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-lg-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-lg-offset-0{margin-left:0}.col-lg-offset-1{margin-left:8.33333333%}.col-lg-offset-2{margin-left:16.66666667%}.col-lg-offset-3{margin-left:25%}.col-lg-offset-4{margin-left:33.33333333%}.col-lg-offset-5{margin-left:41.66666667%}.col-lg-offset-6{margin-left:50%}.col-lg-offset-7{margin-left:58.33333333%}.col-lg-offset-8{margin-left:66.66666667%}.col-lg-offset-9{margin-left:75%}.col-lg-offset-10{margin-left:83.33333333%}.col-lg-offset-11{margin-left:91.66666667%}.start-lg{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-lg{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-lg{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-lg{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-lg{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-lg{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-lg{-ms-flex-pack:distribute;justify-content:space-around}.between-lg{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-lg{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-lg{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}</style><link href=/index.xml rel=alternate type=application/rss+xml title="Airing Weekly"><style>@font-face{font-family:bree serif;font-style:normal;font-weight:400;src:url(https://airing.ursb.me/fonts/BreeSerif-Regular.ttf?max_age=25920000)format('woff2');unicode-range:U+100-24F,U+259,U+1E??,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:bree serif;font-style:normal;font-weight:400;src:url(https://airing.ursb.me/fonts/BreeSerif-Regular.ttf?max_age=25920000)format('woff2');unicode-range:U+??,U+131,U+152-153,U+2BB-2BC,U+2C6,U+2DA,U+2DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:lxgw wenkai gb;font-style:normal;font-weight:400;src:url(https://airing.ursb.me/fonts/LXGWWenKaiGB-Regular.ttf?max_age=25920000)format('woff2')}@font-face{font-family:bungee shade;font-style:normal;font-weight:400;src:url(https://airing.ursb.me/fonts/BungeeShade-Regular.ttf?max_age=25920000)format('woff2');unicode-range:U+102-103,U+110-111,U+128-129,U+168-169,U+1A0-1A1,U+1AF-1B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:bungee shade;font-style:normal;font-weight:400;src:url(https://airing.ursb.me/fonts/BungeeShade-Regular.ttf?max_age=25920000)format('woff2');unicode-range:U+100-24F,U+259,U+1E??,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:bungee shade;font-style:normal;font-weight:400;src:url(https://airing.ursb.me/fonts/BungeeShade-Regular.ttf?max_age=25920000)format('woff2');unicode-range:U+??,U+131,U+152-153,U+2BB-2BC,U+2C6,U+2DA,U+2DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body><article class="post Chinese" id=article><div class=row><div class=col-xs-12><div class=site-header><header><div class=header-title><a href=/>Airing Weekly</a></div><div class=header-subtitle>Log something weekly, want you can be happy.</div></header><div class="row end-md center-xs header-items"><div class=header-item><a href=https://weekly.ursb.me/index.xml target=_blank>RSS</a></div><div class=header-item><a href=https://me.ursb.me/about.html target=_blank>About Me</a></div><div class=header-item><a href=https://github.com/airingursb target=_blank>Github</a></div></div><div class="row end-xs"></div><div class=header-line></div></div><header class=post-header><h1 class=post-title>WJ.14: Chromium Rendering Pipeline - Introduce</h1><div class="row post-desc"><div class=col-xs-6><time class=post-date datetime="2022-08-14 13:37:47 +0800">14 Aug 2022</time></div><div class=col-xs-6><div class=post-author><a target=_blank href=https://ursb.me>@Airing</a></div></div></div></header><div class="post-content markdown-body"><div class="admonition warning"><p class="first admonition-title">Warning</p><p>如果您看到本提示，说明该文章目前仍未完成，会不定期迭代更新，该系列文章完成时会合稿发布博客。如果您有任何疑问或反馈，请联系 <a href=https://ursb.me>@airing</a>。<strong>Last update: August 20 2022</strong></p></div><div class="admonition sourcecode"><p class="first admonition-title">Purpose of this document</p><p><p>本文档系个人研究 Chromium 渲染管线的笔记记录，本文介绍 Chromium 的一些基础知识与渲染管线的主要流程。</p><p>本文分析的源码基于当前最新版本 <code>107</code>，每个版本类名/函数名和对应的具体实现或许有所差异，但主逻辑目前来看不会有所变动。</p><p>推荐阅读本系列后续文章：</p><ul><li><a href=/posts/weekly-15>Chromium Rendering Pipeline - Parsing</a></li></ul></p></div><h2 id=introduce-to-blink>Introduce to Blink</h2><p>Blink 是 Web 的渲染引擎，Chromium 和 Android Webview 都是用 Blink 作为渲染引擎。</p><p style=position:relative><span class=aside><a href=https://chromium.googlesource.com/chromium/src/+/HEAD/third_party/blink/public>Blink Public API</a></span></p><figure><img src="https://airing.ursb.me/image%2Fblog%2F717306-20180919114752433-1539598716.png?max_age=25920000" alt="https://airing.ursb.me/image%2Fblog%2F717306-20180919114752433-1539598716.png?max_age=25920000"><figcaption><p>Figure: Blink in Web platform</p></figcaption></figure><p style=position:relative><span class=aside>你可以阅读 <a href="https://docs.google.com/document/d/1aitSOucL0VHZa9Z2vbRJSyAIsAz24kX8LFByQ5xQnUg/edit?pli=1#">How Blink works</a> 获取更多关于 Blink 的知识。</span></p><p>Blink 包括以下特性：</p><ul><li>实现了 Web 平台的规范（也就是 <a href=https://html.spec.whatwg.org/multipage/?>HTML 标准</a>），包括 DOM，CSS 和 WebIDL；</li><li>内嵌 V8 运行 JavaScript；</li><li>通过底层的网络栈请求资源；</li><li>构建 DOM 树；</li><li>计算样式和排版；</li><li>内嵌 <a href=https://chromium.googlesource.com/chromium/src/+/HEAD/cc/README.md>Chrome Compositor</a> 用于绘图；</li></ul><div class="admonition sourcecode"><p class="first admonition-title">Source to read</p><p><p>从代码结构的角度来看，&ldquo;Blink&rdquo; 指的是 <a href=https://chromium.googlesource.com/chromium/src/+/HEAD/third_party/blink/>//third_party/blink/</a> 目录下的代码。</p><p>从项目的角度来看，&ldquo;Blink&rdquo; 指的是实现 Web 平台特性的项目，实现这些 Web 特性的代码分布在 <a href=https://chromium.googlesource.com/chromium/src/+/HEAD/third_party/blink/>//third_party/blink/</a>， <a href=https://chromium.googlesource.com/chromium/src/+/HEAD/content/renderer/>//content/renderer/</a>，<a href=https://chromium.googlesource.com/chromium/src/+/HEAD/content/browser/>//content/browser/</a> 及其他相关依赖。</p></p></div><h3 id=renderer-architecture-overview>Renderer architecture overview</h3><p>本文中我们重点介绍渲染管线，它的代码在 <a href=https://chromium.googlesource.com/chromium/src/+/HEAD/third_party/blink/renderer/>//third_party/blink/renderer</a>下，目录结构如下所示：</p><ul><li>controller/: 一些使用 core/ 和 modules/ 的高级库。比如，devtools 的前端。</li><li>core/ and bindings/core: core/ 实现了跟 DOM 紧密相关的特性。bindings/core 属于 core/ 的一部分，bindings 目录独立是因为它和 V8 强相关。</li><li>modules/ and bindings/modules: modules/ 实现一些与 DOM 无关的特性，如 WebAudio，IndexDB 等。bindings/modules/ 属于 modules/ 的一部分, bindings 目录独立是因为它和 V8 强相关。</li><li>platform/: Blink 的低阶功能集合，从庞大的 core/ 中分解出来，包括 geometry 和 graphics 等相关的功能。</li><li>extensions/</li><li>public/web</li><li>public/platform</li><li>public/common</li><li>//base: chromium 基础库，基础库的源码解读可见 <a href=https://docs.google.com/document/d/13zOvNpBjUfI89HehtVl7CWQT-huJAUcvb7fNbse3fdc/edit#>Chromium //base</a></li><li>//cc: chromium composite</li><li>V8: JavaScript 解释器</li></ul><figure><img src="https://airing.ursb.me/image%2Fblog%2F20220814145428%402x.png?max_age=25920000" alt="https://airing.ursb.me/image%2Fblog%2F20220814145428%402x.png?max_age=25920000" width=50%><figcaption><p>Figure: Dependencies in //third_party/blink/renderer</p></figcaption></figure><h3 id=renderer-processes>Renderer processes</h3><p style=position:relative><span class=aside>过去进程间通信使用 <a href=https://www.chromium.org/developers/design-documents/inter-process-communication>Chromium IPC</a>，现在还有很多代码仍旧在使用 <a href=https://chromium.googlesource.com/chromium/+/refs/heads/trunk/ipc/>IPC</a>。</span></p><p>Chromium 拥有一个 browser processes 和 N 个沙盒 renderer processes，其中 Blink 运行在 renderer processes。browser 与 renderer 进程间通讯是由 <a href=https://chromium.googlesource.com/chromium/src/+/master/mojo/README.md>Mojo</a>来实现的。</p><p>Blink renderer processes 模型如下图所示：</p><figure><img src=https://airing.ursb.me/image%2Fblog%2FuIqf0QQZxF6mHPDWFEjz.png alt=https://airing.ursb.me/image%2Fblog%2FuIqf0QQZxF6mHPDWFEjz.png><figcaption><p><a href=https://developer.chrome.com/blog/inside-browser-part3/>Figure: Renderer processes</a></p></figcaption></figure><p style=position:relative><span class=aside>Renderer process with a main thread, worker threads, a compositor thread, and a raster thread inside.</span></p><p>Renderer process 拥有一个 main thread, 多个 worker threads, 一个 compositor thread, 以及一个 raster thread。</p><p>而 Blink 几乎所有的主要活动都发生在 main thread，如 JavaScript 调用，DOM 解析、CSS 样式和排版计算，因此 Blink 的架构被认为主要是单线程的。</p><h2 id=rendering-pipeline>Rendering Pipeline</h2><h3 id=goals>Goals</h3><p>渲染管线的目的是将 WebContent 渲染到屏幕上，它会将 HTML 的内容经过层层处理，最后通过 Open GL 操作显卡硬件驱动，将 HTML 内容光栅化输出到屏幕上。</p><p>需要注意的是 WebContent 指的是下图区域，即 HTML 的内容，不包括浏览器外壳：</p><figure><img src=https://airing.ursb.me/image%2Fblog%2F20220814160559%402x.png alt=https://airing.ursb.me/image%2Fblog%2F20220814160559%402x.png><figcaption><p>Figure: WebContent</p></figcaption></figure><p>除此之外，渲染管线还设计了优良的数据结构，目的是高效处理渲染内容的更新。</p><h3 id=pipeline>Pipeline</h3><p>Blink 渲染管线如下图所示:</p><p style=position:relative><span class=aside>&ldquo;impl&rdquo; = compositor thread.</span></p><figure><img src="https://airing.ursb.me/image%2Fblog%2Fimage_1660182336555_0.png?max_age=25920000" alt="https://airing.ursb.me/image%2Fblog%2Fimage_1660182336555_0.png?max_age=25920000"><figcaption><p>Figure: Chromium Rendering Pipeline (by Life of a pixel)</p></figcaption></figure><p>这张图来自于 <a href="https://docs.google.com/presentation/d/1boPxbgNrTU0ddsc144rcXayGA_WF53k96imRH8Mp34Y/edit#slide=id.ga884fe665f_64_45">Life of a pixel</a>，虽然描述了管线的关键流程，但不是很完整。此外也不是很准确，比如 Raster 阶段是运行在专门的 Raster thread 而不是 Compositor thread 中。</p><p>因此，结合 cc 与 viz 的工作流，重新绘制了下图：</p><figure><img src=/images/chromium-rendering-pipeline/full-rendering-pipeline.png alt=/images/chromium-rendering-pipeline/full-rendering-pipeline.png><figcaption><p>Figure: Chromium Rendering Pipeline</p></figcaption></figure><p>完整的渲染管线经历以下几个阶段:</p><ol><li>Parsing</li><li>Style</li><li>Layout</li><li>Composting</li><li>Paint</li><li>Commit</li><li>Tiling</li><li>Raster</li><li>Activate</li><li>Submit</li><li>Draw</li><li>Display</li></ol><p>渲染管线的前半程是在 Renderer process 中进行的，其中渲染管线的 1-5 阶段运行在 Main thread 中，这也是 Blink 负责的内容；而 6-10 阶段，除了 Raster 是运行在专门的 Raster thread 中，其它流程均是在 Compositor thread 中进行的，这也是 cc 的主要内容，其中 cc 的数据源由 Paint 产生。渲染管线的尾程则是在 GPU process 中进行的，跨进程的环节交给了 viz 负责。</p><p>在后续的文章，我们将逐个解析渲染管线的各个流程中 Chromium 是如何工作的。</p><h2 id=resources>Resources</h2><ul><li><a href=https://developer.chrome.com/blog/inside-browser-part3/>Inside look at modern web browser (part 3)</a></li><li><a href="https://docs.google.com/presentation/d/1boPxbgNrTU0ddsc144rcXayGA_WF53k96imRH8Mp34Y/edit#slide=id.ga884fe665f_64_45">Life of a pixel - Google Docs</a></li></ul></div><div class="row middle-xs"><div class=col-xs-12></div></div><div class=row><div class=col-xs-12><br><br><p>Subscribe <a target=_blank href=https://weekly.ursb.me/index.xml>Airing's Weekly</a></p><p>© 粤ICP备16057808号</p></div></div><div style=height:50px></div><div class=site-footer></div></div></div></article><script></script></body></html>